<?xml version="1.0" encoding="utf-8"?>
<mx:HBox xmlns:mx="http://www.adobe.com/2006/mxml" width="100%" height="100%"
		  paddingBottom="20" paddingLeft="20" paddingRight="10" paddingTop="20"
		  creationComplete="hbox1_creationCompleteHandler(event)">
	<mx:Script>
		<![CDATA[
			import mx.events.FlexEvent;
			import mx.events.ListEvent;
			private var _tilesManager:TileMapManager;
			
			[Bindable]
			private var currentSample:Bitmap;
			[Bindable]
			public var fileNames:Array;
			[Bindable]
			public var wSize:Array = [16,24,32];
			[Bindable]
			public var hSize:Array = [16,24,32];
			
			protected function hbox1_creationCompleteHandler(event:FlexEvent):void
			{
				_tilesManager = TileMapManager.getInstance();
				_tilesManager.addEventListener(TileMapManager.FILE_PROCESSED,fileProcessedHandler);
			}
			
			protected function fileProcessedHandler(event:Event):void
			{
				fileNames = _tilesManager.fileNames;
				currentSample = _tilesManager.getBitmapByID(fileNames[0]);
			}
			
			protected function button1_clickHandler(event:MouseEvent):void
			{
				// TODO Auto-generated method stub
				
			}
			
			protected function combobox1_changeHandler(event:ListEvent):void
			{
				currentSample = _tilesManager.getBitmapByID(fileSelector.selectedLabel);
			}
			
			protected function tileSizeChangeHandler(event:ListEvent):void
			{
				redrawGuideLines(int(tileWidthComboBox.selectedLabel),int(tileHeightComboBox.selectedLabel));
			}
			
			private function redrawGuideLines(tileWidth:int, tileHeight:int):void
			{
				if(!currentSample)return;
				canvas.graphics.clear();
				canvas.graphics.lineStyle(1,0x333333);
				const hNumber:int = currentSample.width / tileWidth;
				const vNumber:int = currentSample.height / tileHeight;
				for (var i:int = 0; i < hNumber; i++) 
				{
					for (var j:int = 0; j < vNumber; j++) 
					{
						canvas.graphics.drawRect(i * tileWidth * image.scaleX,j * tileHeight * image.scaleY,tileWidth * image.scaleX,tileHeight * image.scaleY);
					}
				}
				
			}
			
			protected function image_updateCompleteHandler(event:FlexEvent):void
			{
				redrawGuideLines(int(tileWidthComboBox.selectedLabel),int(tileHeightComboBox.selectedLabel));
			}
			
		]]>
	</mx:Script>
	<mx:VBox width="100%" height="100%" borderStyle="solid" borderColor="#aaaaaa"
			 paddingBottom="20" paddingLeft="20" paddingRight="20" paddingTop="20" backgroundColor="#111111">
		<mx:HBox>
			<mx:Label color="#AAF0FF" text="Select texture to preview"/>
			<mx:ComboBox id="fileSelector" dataProvider="{fileNames}" width="140" color="#ffffff" change="combobox1_changeHandler(event)"/>
		</mx:HBox>
		<mx:Canvas  borderStyle="solid" borderColor="#aaaaaa" width="100%" height="100%" backgroundColor="#ffffff">
			<mx:Image x="0" y="0" id="image" width="100%" height="100%" source="{currentSample}" dataChange="image_updateCompleteHandler(event)"/>
			<mx:HBox id="canvas" width="100%" height="100%" />
		</mx:Canvas>
	</mx:VBox>
	<mx:VBox width="200" height="100%" >
		<mx:Form width="200" height="100%" fontSize="12" color="#ffffff" label="Parameters">
			<mx:FormItem label="Tile width:">
				<mx:ComboBox id="tileWidthComboBox" width="60" dataProvider="{wSize}" change="tileSizeChangeHandler(event)"/>
			</mx:FormItem>
			<mx:FormItem label="Tile height:">
				<mx:ComboBox id="tileHeightComboBox" width="60" dataProvider="{hSize}" change="tileSizeChangeHandler(event)"/>
			</mx:FormItem>			
		</mx:Form>
		<mx:Button label="Generate" width="100%" height="50" click="button1_clickHandler(event)"/>
	</mx:VBox>
</mx:HBox>
